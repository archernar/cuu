#!/usr/bin/ksh
Tmp="/tmp/$$"
TmpDir="/tmp/dir$$"
trap 'rm -f "$Tmp" >/dev/null 2>&1' 0
trap "exit 2" 1 2 3 13 15
rm $Tmp  >/dev/null 2>&1

LOCAL=""
while getopts "l" arg
do
	case $arg in
            l) LOCAL="yes" ;;
        esac
done
ANON=`date`
print $ANON
cuu -c utilcommands | grep -v alias  > $Tmp

print "# CUU Repo - A set of AWS CLI Wrappers and Utility Scripts" > README.md
print "Script | Description | Usage | Notes" >> README.md
print "------ | ----------- | ----- | -----" >> README.md
print "cuu | A multi function AWS CLI Wrapper Utility | See below" >> README.md
print "ec2ls | A ec2 listing utility | ec2ls -a \"\<profile list\>\" -r \"\<region list\>\" | All US regions is default" >> README.md
print "### Examples" >> README.md
echo "<pre>" >> README.md
print " cuu -a ENV1 -c USERLIST" >> README.md
print " ec2ls -a \"ENV1 EVN2\""  >> README.md
echo "</pre>" >> README.md
echo " " >> README.md

print "## CUU - An AWS CLI Wrapper" >> README.md
print "###### Setup:  CUUHOME enviroment variable should be set to the cuu install directory" >> README.md
echo "<pre>" >> README.md
gawk -v ANON="$ANON" -f readme.awk cuu  >> README.md
echo "</pre>" >> README.md


echo "### Commands  " >> README.md
echo "<pre>" >> README.md
echo "User Commands  " >> README.md
cat $Tmp | egrep "^[ ]*user" >> README.md

echo "Password Commands  " >> README.md
cat $Tmp | egrep "^[ ]*password" >> README.md
echo "  " >> README.md

echo "AccessKey Commands  " >> README.md
cat $Tmp | egrep "^[ ]*accesskey" >> README.md
echo "  " >> README.md



echo "Policy Commands  " >> README.md
cat $Tmp | egrep "^[ ]*policy" >> README.md
echo "  " >> README.md
echo "Group Commands  " >> README.md
cat $Tmp | egrep "^[ ]*group" >> README.md
echo "  " >> README.md
echo "Role Commands  " >> README.md
cat $Tmp | egrep "^[ ]*role" >> README.md
echo "  " >> README.md


echo "VPC Commands  " >> README.md
cat $Tmp | egrep "^[ ]*vpc" >> README.md
echo "  " >> README.md

echo "EC2 Commands  " >> README.md
cat $Tmp | egrep "^[ ]*ec2" >> README.md
echo "  " >> README.md
echo "AMI Commands  " >> README.md
cat $Tmp | egrep "^[ ]*ami" >> README.md
echo "  " >> README.md


echo "S3 Commands  " >> README.md
cat $Tmp | egrep "^[ ]*s3" >> README.md

echo "  " >> README.md
echo "CloudTrail Commands  " >> README.md
cat $Tmp | egrep "^[ ]*cloudtrail" >> README.md

echo "  " >> README.md
echo "Utility Commands  " >> README.md
cat $Tmp | egrep "^[ ]*util" >> README.md
echo "</pre>" >> README.md


echo "### Command Aliases" >> README.md
echo "<pre>" >> README.md
cuu -c aliaslist >> README.md
echo "</pre>" >> README.md


echo "### ~/.cuu.txt can contain defaults for these settings" >> README.md
echo "<pre>" >> README.md
cat .cuu.txt >> README.md
echo "</pre>" >> README.md
# cuu -c commandlist | sort | gawk '{printf "%s ", $0;if ((NR%4)==0) print "";}' | column -t >> README.md
# cuu -c commands | sort  >> README.md


echo "### Build Date" >> README.md
echo "<pre>" >> README.md
date >> README.md
echo "</pre>" >> README.md


git add readme.awk
git add README.md 
git add html.awk
git add tabber.awk
git add indent.awk
git add noindent.awk
git add cuu.awk
git add trim.awk
git add pushit
git add spark
git add cuu

git commit -m "Update"

if [ "$LOCAL" == "" ] ; then
     git push -u origin master
fi

